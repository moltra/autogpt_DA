{"url": "https://api.github.com/repos/Significant-Gravitas/Auto-GPT/issues/2838", "repository_url": "https://api.github.com/repos/Significant-Gravitas/Auto-GPT", "labels_url": "https://api.github.com/repos/Significant-Gravitas/Auto-GPT/issues/2838/labels{/name}", "comments_url": "https://api.github.com/repos/Significant-Gravitas/Auto-GPT/issues/2838/comments", "events_url": "https://api.github.com/repos/Significant-Gravitas/Auto-GPT/issues/2838/events", "html_url": "https://github.com/Significant-Gravitas/Auto-GPT/pull/2838", "id": 1678941361, "node_id": "PR_kwDOJKSTjM5O4mUp", "number": 2838, "title": "fix: use a modern prompt to avoid ^[[D char when using arrow left and\u2026", "user": {"login": "gabkk", "id": 10153882, "node_id": "MDQ6VXNlcjEwMTUzODgy", "avatar_url": "https://avatars.githubusercontent.com/u/10153882?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gabkk", "html_url": "https://github.com/gabkk", "followers_url": "https://api.github.com/users/gabkk/followers", "following_url": "https://api.github.com/users/gabkk/following{/other_user}", "gists_url": "https://api.github.com/users/gabkk/gists{/gist_id}", "starred_url": "https://api.github.com/users/gabkk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gabkk/subscriptions", "organizations_url": "https://api.github.com/users/gabkk/orgs", "repos_url": "https://api.github.com/users/gabkk/repos", "events_url": "https://api.github.com/users/gabkk/events{/privacy}", "received_events_url": "https://api.github.com/users/gabkk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 5272676243, "node_id": "LA_kwDOJKSTjM8AAAABOkankw", "url": "https://api.github.com/repos/Significant-Gravitas/Auto-GPT/labels/enhancement", "name": "enhancement", "color": "a2eeef", "default": true, "description": "New feature or request"}, {"id": 5381931159, "node_id": "LA_kwDOJKSTjM8AAAABQMnAlw", "url": "https://api.github.com/repos/Significant-Gravitas/Auto-GPT/labels/needs%20discussion", "name": "needs discussion", "color": "0e8a16", "default": false, "description": "To be discussed among maintainers"}, {"id": 5400185961, "node_id": "LA_kwDOJKSTjM8AAAABQeBMaQ", "url": "https://api.github.com/repos/Significant-Gravitas/Auto-GPT/labels/conflicts", "name": "conflicts", "color": "FBCA04", "default": false, "description": "Automatically applied to PRs with merge conflicts"}, {"id": 5410633608, "node_id": "LA_kwDOJKSTjM8AAAABQn-3iA", "url": "https://api.github.com/repos/Significant-Gravitas/Auto-GPT/labels/size/l", "name": "size/l", "color": "709B6D", "default": false, "description": ""}], "state": "open", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2023-04-21T18:42:32Z", "updated_at": "2023-04-30T04:48:28Z", "closed_at": null, "author_association": "NONE", "active_lock_reason": null, "draft": false, "pull_request": {"url": "https://api.github.com/repos/Significant-Gravitas/Auto-GPT/pulls/2838", "html_url": "https://github.com/Significant-Gravitas/Auto-GPT/pull/2838", "diff_url": "https://github.com/Significant-Gravitas/Auto-GPT/pull/2838.diff", "patch_url": "https://github.com/Significant-Gravitas/Auto-GPT/pull/2838.patch", "merged_at": null}, "body": "### Background\r\nThis PR aims to fix an issue with the input prompt where arrow keys would generate unwanted characters (`^[[D`) in the input when using arrows.\r\n\r\nWe also want to ensure that the colored output works correctly with the new input method.\r\n\r\nprompt_toolkit also support history with up and down arrow which could be useful if we plan to have more user interaction with the agent in the futur\r\n\r\n### Changes\r\n1. Replaced the `input()` function with `prompt_toolkit`'s `PromptSession` to prevent unwanted characters when using arrow keys.\r\n2. Adjusted all `clean_input` calls to use `prompt_toolkit`'s `HTML` formatting instead of `colorama` ANSI escape codes.\r\n3. Added the `prompt_toolkit` package to the `requirements.txt` file.\r\n\r\n### Documentation\r\nThe changes are documented in the form of in-code comments and by updating the `clean_input` function to accept `FormattedText` from `prompt_toolkit`.\r\n\r\n### Test Plan\r\nTested the changes by running the script and interacting with the modified prompts. Verified that the arrow keys no longer produce unwanted characters and that the colored output is displayed correctly.\r\n\r\n### PR Quality Checklist\r\n- [x] My pull request is atomic and focuses on a single change.\r\n- [x] I have thoroughly tested my changes with multiple different prompts.\r\n- [x] I have considered potential risks and mitigations for my changes.\r\n- [x] I have documented my changes clearly and comprehensively.\r\n- [x] I have not snuck in any \"extra\" small tweaks changes ", "reactions": {"url": "https://api.github.com/repos/Significant-Gravitas/Auto-GPT/issues/2838/reactions", "total_count": 0, "+1": 0, "-1": 0, "laugh": 0, "hooray": 0, "confused": 0, "heart": 0, "rocket": 0, "eyes": 0}, "timeline_url": "https://api.github.com/repos/Significant-Gravitas/Auto-GPT/issues/2838/timeline", "performed_via_github_app": null, "state_reason": null}